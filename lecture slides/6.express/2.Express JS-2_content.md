Here is the formatted text with shortened long descriptions only (paragraphs), keeping all examples, code, and other content intact:

---

**Express JS**
**MEAN/MERN STACK**

---

**Learning Objectives:**
- Routing
- static files
- Templating
- Restful API
- Authentication and Authorization with JWT token

**MEAN/MERN Stack**

---

**Introduction to Express JS**

**Routing:**
Routing defines how an app responds to client requests at specific endpoints (URI/path + HTTP method). Each route can have handler functions that execute on a match. Structure:  
`app.METHOD(PATH, HANDLER)`  
where `app` is Express instance, `METHOD` is HTTP method, `PATH` is server path, `HANDLER` is the function.

Examples:  
```js
app.get('/', (req, res) => res.send('Hello World!'))
app.post('/', (req, res) => res.send('Got a POST request'))
app.put('/user', (req, res) => res.send('Got a PUT request at /user'))
app.delete('/user', (req, res) => res.send('Got a DELETE request at /user'))
```

Routing uses Express app methods (`app.get()`, `app.post()`, etc.). `app.all()` handles all HTTP methods; `app.use()` uses middleware as callback. Multiple callbacks can be used with `next()`.

---

**Introduction to Express JS**
`app.all('/secret', (req, res, next) => { console.log('Accessing...'); next(); })`

**Route paths**  
Paths define endpoints and can be strings, patterns, or regex. Characters `?`, `+`, `*`, `()`, `-`, `.` are interpreted. Escape `$` as `([$])`.

Examples:  
`app.get('/', ...)` matches root.  
`app.get('/about', ...)` matches `/about`.  
`app.get('/random.text', ...)` matches `/random.text`.

String patterns:  
`app.get('/ab?cd', ...)` matches `acd`, `abcd`.  
`app.get('/ab+cd', ...)` matches `abcd`, `abbcd`, etc.  
`app.get('/ab*cd', ...)` matches `abcd`, `abxcd`, etc.  
`app.get('/ab(cd)?e', ...)` matches `/abe`, `/abcde`.

Regex examples:  
`app.get('/a/', ...)` matches anything with "a".  
`app.get(/.*fly$/, ...)` matches `butterfly`, `dragonfly`.

**Route parameters** capture URL segment values into `req.params`.  
Example route: `/users/:userId/books/:bookId`.  
Request: `http://localhost:8080/users/34/books/8989` gives `req.params: {"userId": "34", "bookId": "8989"}`.

---

**Introduction to Express JS**
Define route parameters:  
`app.get('/users/:userId/books/:bookId', (req, res) => res.send(req.params))`  
Names must be word characters (`[A-Za-z0-9_]`). Hyphen/dot can be used:  
`/flights/:from-:to` → `LAX-SFO` → `{"from":"LAX","to":"SFO"}`  
`/plantae/:genus.:species` → `Prunus.persica` → `{"genus":"Prunus","species":"persica"}`  
Add regex for control: `/user/:userId(\\d+)`.

**Route handlers** can be multiple callbacks, arrays, or combinations. Example single callback:  
`app.get('/example/a', (req, res) => res.send('Hello from A!'))`

Multiple callbacks:  
```js
app.get('/example/b', (req, res, next) => {
  console.log('response by next function...'); next();
}, (req, res) => res.send('Hello from B!'));
```

Array of callbacks:  
```js
const cb0 = (req, res, next) => { console.log('CB0'); next(); }
const cb1 = (req, res, next) => { console.log('CB1'); next(); }
const cb2 = (req, res) => res.send('Hello from C!')
app.get('/example/c', [cb0, cb1, cb2])
```

Combination:  
```js
app.get('/example/d', [cb0, cb1], (req, res, next) => {
  console.log('response by next...'); next();
}, (req, res) => res.send('Hello from D!'));
```

---

**Introduction to Express JS**

**Response methods** send response and end cycle. If none called, request hangs.  
| Method | Description |
|--------|-------------|
| res.download() | Prompt file download |
| res.end() | End response process |
| res.json() | Send JSON response |
| res.jsonp() | Send JSON with JSONP support |
| res.redirect() | Redirect request |
| res.render() | Render view template |
| res.send() | Send various response types |
| res.sendFile() | Send file as octet stream |
| res.sendStatus() | Set status code and send string representation |

**app.route()** creates chainable handlers for a path, reducing redundancy. Example:  
```js
app.route('/book')
  .get((req, res) => res.send('Get random book'))
  .post((req, res) => res.send('Add book'))
  .put((req, res) => res.send('Update book'))
```

---

**Introduction to Express JS**

**Templating**  
Template engines merge HTML with program data, replacing variables at runtime. Example: `<%= username %>` → `Welcome John`.  
Engines: EJS, Jade/Pug, Vash, Mustache, Dust.js, Nunjucks, Handlebars, ATPL, HAML.

**EJS** (Embedded JavaScript) usage:  
`npm install --save ejs`  
Create `views` folder (default). Set view engine: `app.set("view engine","ejs")`.  
EJS files use tags: `<% %>` (logic), `<%= %>` (display), `<%- %>`.  

Example server:  
```js
var express = require("express");
var app = express();
app.set("view engine","ejs");
app.get("/", function(req, res) {
  res.render("display");
});
app.listen(3000, function() {
  console.log("Node server running...");
});
```

Template `display.ejs`:  
```html
<!DOCTYPE html>
<html>
<body>
  <p>Hello <%= user %></p>
</body>
</html>
```

---

**Introduction to Express JS**

**Sending variables to EJS**  
Pass data when rendering: `res.render('display', {user:'John'})`. Display with `<%= user %>`.  
Send arrays/objects:  
```js
var authors = [
  {name:"Andrew", article:"node.js"},
  {name:"Brad", article:"express.js"},
  {name:"John", article:"mongoose"}
];
app.get("/", function(req, res) {
  res.render("display", { authors });
});
```

EJS template loops:  
```html
<ul>
  <% authors.forEach(function(author){ %>
    <li><%= author.name %></li>
  <% }) %>
</ul>
```

---

**Introduction to Express JS**

**REST API**  
REST APIs use HTTP methods to send/receive data (JSON, HTML, XML). REST is architecture for web services; CRUD operations correspond to HTTP methods. Express simplifies API development with middleware.

**HTTP Request Types** for CRUD:  
- POST: Submit data (create/edit)  
- GET: Request data (read)  
- PUT: Replace resource (update)  
- DELETE: Delete entity

**Setting Up Project**  
`npm init` creates `package.json`. Add start script: `"start": "node index.js"`.  
Install Express: `npm install --save express`.  
Dependencies tracked in `package-lock.json`. Do not commit `node_modules`.

**Creating Simple Endpoint**  
```js
const express = require('express');
const app = express();
const port = 3000;
app.get('/', (req, res) => res.send('Hello World, from express'));
app.listen(port, () => console.log('App listening on port ${port}!'));
```

---

**Introduction to Express JS**

**Middleware** extends Express. Install:  
`npm install --save body-parser` (parses request body)  
`npm install --save cors` (cross-origin resource sharing)

**Building REST API** (Books example)  
File `book-api.js`:  
```js
const express = require('express')
const bodyParser = require('body-parser');
const cors = require('cors');
const app = express();
const port = 3000;
let books = [];
app.use(cors());
app.use(bodyParser.urlencoded({ extended: false }));
app.use(bodyParser.json());
app.post('/book', (req, res) => {
  const book = req.body;
  console.log(book);
  books.push(book);
  res.send('Book added');
});
app.listen(port, () => console.log('App listening on port ${port}!'));
```

HTML form `new-book.html`:  
```html
<form action="http://localhost:3000/book" method="POST">
  <input name="isbn">
  <input name="title">
  <!-- other fields -->
  <button type="submit">Submit</button>
</form>
```

---

**Introduction to Express JS**

**Getting All Books**  
`app.get('/books', (req, res) => res.json(books));`  
Display with HTML/JS: `book-list.html` template and `book-list.js`.

`book-list.js` loads books via GET request:  
```js
const loadBooks = () => {
  const xhttp = new XMLHttpRequest();
  xhttp.open("GET", "http://localhost:3000/books", false);
  xhttp.send();
  const books = JSON.parse(xhttp.responseText);
  for (let book of books) {
    const x = `<div class="col-4">...${book.title}...${book.isbn}...</div>`;
    document.getElementById('books').innerHTML += x;
  }
}
loadBooks();
```

**Retrieving Book by ISBN**  
```js
app.get('/book/:isbn', (req, res) => {
  const isbn = req.params.isbn;
  for (let book of books) {
    if (book.isbn == isbn) {
      res.json(book);
      return;
    }
  }
  res.status(404).send('Book not found');
});
```

---

**Introduction to Express JS**

**Deleting Books**  
```js
app.delete('/book/:isbn', (req, res) => {
  const isbn = req.params.isbn;
  books = books.filter(i => i.isbn != isbn);
  res.send('Book deleted');
});
```

`book-list.js` delete function:  
```js
const deleteBook = (isbn) => {
  const xhttp = new XMLHttpRequest();
  xhttp.open("DELETE", `http://localhost:3000/book/${isbn}`, false);
  xhttp.send();
  location.reload();
}
```

**Editing Books**  
```js
app.post('/book/:isbn', (req, res) => {
  const isbn = req.params.isbn;
  const newBook = req.body;
  for (let i = 0; i < books.length; i++) {
    if (books[i].isbn == isbn) {
      books[i] = newBook;
    }
  }
  res.send('Book edited');
});
```

`setEditModal` function in `book-list.js`:  
```js
const setEditModal = (isbn) => {
  const xhttp = new XMLHttpRequest();
  xhttp.open("GET", `http://localhost:3000/book/${isbn}`, false);
  xhttp.send();
  const book = JSON.parse(xhttp.responseText);
  document.getElementById('isbn').value = isbn;
  document.getElementById('title').value = book.title;
  // set other fields
  document.getElementById('editForm').action = `http://localhost:3000/book/${isbn}`;
}
```

---

**MEAN/MERN Stack**

**Questions ?**

43

---