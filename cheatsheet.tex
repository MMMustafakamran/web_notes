\documentclass[8pt, a4paper, landscape]{extarticle}

\usepackage[left=0.1cm,right=0.1cm,top=0.1cm,bottom=0.1cm]{geometry}
\usepackage{multicol}
\usepackage{xcolor}
\usepackage{listings}
\usepackage{enumitem}
\usepackage{titlesec}
\usepackage{amsmath}
\usepackage{microtype} % Better character spacing to save horizontal space

% --- Visual Setup ---
\setlength{\parindent}{0pt}
\setlength{\parskip}{0pt}
\setlength{\columnsep}{0.1cm} % Reduced from 0.2cm

% --- Code Formatting (Rich & Multicolored) ---
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codeblue}{rgb}{0.0,0.3,0.7}
\definecolor{codepurple}{rgb}{0.5,0,0.5}
\definecolor{codeorange}{rgb}{0.8,0.4,0}
\definecolor{codered}{rgb}{0.8,0,0}

\lstdefinelanguage{JavaScript}{
  keywords={break, case, catch, continue, debugger, default, delete, do, else, false, finally, for, function, if, in, instanceof, new, null, return, switch, this, throw, true, try, typeof, var, void, while, with, as, async, await, const, let},
  morekeywords=[2]{require, exports, module, process, console, express, app, mongoose, Schema, model, ObjectId, os, path, dns},
  sensitive=true,
  morecomment=[l]{//},
  morecomment=[s]{/*}{*/},
  morestring=[b]',
  morestring=[b]",
  morestring=[b]`
}

\lstset{
    language=JavaScript,
    backgroundcolor=\color{white},
    basicstyle=\ttfamily\tiny,
    commentstyle=\color{codegreen}\tiny,
    keywordstyle=\color{codeblue}\bfseries\tiny,
    keywordstyle=[2]\color{codeorange}\tiny,
    stringstyle=\color{codepurple}\tiny,
    identifierstyle=\color{black}\tiny,
    breaklines=true,
    tabsize=2,
    frame=single,
    framerule=0.2pt,
    xleftmargin=1pt,
    xrightmargin=1pt,
    aboveskip=0pt,
    belowskip=1pt,
    showstringspaces=false,
    escapeinside={(*@}{@*)}
}

% --- Unified Heading Numbering with Compact Grey Box ---
\newcounter{unifiedsection}
\newcommand{\compactsection}[1]{%
    \stepcounter{unifiedsection}%
    \vspace{0.5pt}% reduced from 1pt
    \noindent%
    {\setlength{\fboxsep}{0.5pt}% reduced from 1pt
    \colorbox{black!10}{%
        \makebox[\dimexpr\linewidth-2\fboxsep\relax][l]{\textbf{\scriptsize \theunifiedsection. #1}}%
    }}%
    \vspace{0.5pt}% reduced from 1pt
}

% --- Major Topic Header (Extreme Compact) ---
\newcommand{\topicsection}[1]{%
    \vspace{2pt}% reduced from 4pt
    \noindent%
    {\setlength{\fboxsep}{1.5pt}% reduced from 2pt
    \colorbox{black}{%
        \makebox[\dimexpr\linewidth-2\fboxsep\relax][c]{\color{white}\textbf{\scriptsize #1}}% font size scriptsize
    }}%
    \vspace{1pt}% reduced from 2pt
}

% Global List settings
\setlist{nosep, leftmargin=*} 

\begin{document}
\footnotesize % Set body font to footnotesize

\begin{multicols*}{3}

\topicsection{EXPRESS JS}

\compactsection{Core Server Setup}
Require Express, initialize, and listen on port.
\begin{lstlisting}
const express = require('express');
const app = express();
const PORT = 3000;
app.get('/', (req, res) => res.send('Hello World!'));
app.listen(PORT, () => console.log(`Run on ${PORT}`));
\end{lstlisting}

\compactsection{Route Path Patterns (Exam)}
\textbf{ab?cd} $\to$ b optional (\texttt{acd, abcd}) $\mid$ \textbf{ab+cd} $\to$ 1+ b (\texttt{abcd, abbcd}) $\mid$ \textbf{ab*cd} $\to$ anything between (\texttt{abxcd, ab12cd}) $\mid$ \textbf{/.*fly\$/} $\to$ ends with "fly" (\texttt{dragonfly}) $\mid$ \textbf{:id} $\to$ param (\texttt{/user/34} $\to$ \texttt{req.params.id=34})

\compactsection{Middleware Flow (Exam Focus)}
Needs (req, res, next). Executes in order. If \texttt{next()} isn't called, request hangs.\\
\textbf{t1/t2 Analysis:} Made to \texttt{/about}:
\begin{enumerate}
    \item \texttt{app.use((req, res, next) $\to$ \{ console.log("t1"); next(); \});} $\to$ output: t1.
    \item \texttt{app.get("/about1", ...)} $\to$ Skipped (no match).
    \item \texttt{app.use((req, res, next) $\to$ \{ console.log("t2"); \});} $\to$ Logs t2. \textbf{No next()!}
    \item \texttt{app.get("/about")} is never reached.
\end{enumerate}

\compactsection{Types of Middleware}
\begin{enumerate}
    \item \textbf{Application:} \texttt{app.use()}. Runs for all.
    \item \textbf{Router:} \texttt{express.Router()}. Modular (e.g., \texttt{/api}).
    \item \textbf{Built-in:} \texttt{express.static}, \texttt{express.json}.
    \item \textbf{Error:} 4 args: \texttt{(err, req, res, next)}.
\end{enumerate}

\compactsection{Response Methods}
Ends the cycle.
\begin{itemize}
    \item \texttt{res.send('text/html')} $\mid$ \texttt{res.json(\{obj\})} (APIs)
    \item \texttt{res.render('view', \{dat\})} (EJS/Templates)
    \item \texttt{res.status(404).send('Msg')} $\mid$ \texttt{res.redirect('/url')}
\end{itemize}

\compactsection{EJS Templating}
Dynamic HTML. Server sends data $\to$ EJS $\to$ Browser.\\
\textbf{Controller (app.js):} \texttt{app.set('view engine', 'ejs');}
\begin{lstlisting}
app.get('/show', (req, res) => {
    res.render('books', { books: [{ title: "Node", price: 20 }] }); 
});
\end{lstlisting}
\textbf{View (books.ejs):}
\begin{lstlisting}[language=HTML]
<% books.forEach(function(book) { %> <li><%= book.title %> - $<%= book.price %></li> <% }); %>
\end{lstlisting}

\compactsection{Handling Data (JSON vs. DB)}
\textbf{Local JSON:} \texttt{res.json(usersArray);} (Immediate)\\
\textbf{MongoDB (Mongoose):}
\begin{lstlisting}
app.get('/u', async (req, res) => {
    try { const u = await User.find({}); res.json(u); }
    catch (e) { res.status(500).send(e.message); }
});
\end{lstlisting}

\topicsection{MONGODB \& MONGOOSE}

\compactsection{MongoDB: Core Concepts}
NoSQL, document-oriented, written in C++.\\
\textbf{DB:} Container for collections $\mid$ \textbf{Collection:} Doc group.\\
\textbf{Doc:} Key-value pairs $\mid$ \textbf{CRUD:} Create, Read, Update, Delete.

\compactsection{RDBMS vs. MongoDB}
Table $\to$ Coll $\mid$ Row $\to$ Doc $\mid$ Column $\to$ Field $\mid$ Join $\to$ Embed/\texttt{\$lookup} $\mid$ PK $\to$ \texttt{\_id}

\compactsection{Shell Commands}
\texttt{use DB} (switch) $\mid$ \texttt{db.dropDatabase()} $\mid$ \texttt{db.createCollection("n")} $\mid$ \texttt{db.c.drop()} $\mid$ \texttt{db.c.find()}\\
\textit{Note:} \texttt{db.c.copy()} is \textbf{INVALID}.

\compactsection{Query Operators}
\textbf{\$gt:} Greater than (\texttt{\{ age: \{ \$gt: 25 \} \}}) $\mid$ \textbf{\$set:} Partial update $\mid$ \textbf{Regex:} \texttt{\{ addr: /\^S/ \}} (starts with S).

\compactsection{Mongoose Integration}
\begin{lstlisting}
const mongoose = require('mongoose');
mongoose.connect('mongodb://localhost/db');
const Task = mongoose.model('Task', new mongoose.Schema({ title: String, completed: Boolean }));

app.get('/t', async (req, res) => {
  const pending = await Task.find({ completed: false }); 
  res.json(pending);
});
\end{lstlisting}

\compactsection{Relationships (Connect Collections)}
\textbf{1-1 (Nesting):} Child doc inside parent.
\begin{lstlisting}
const userSchema = new mongoose.Schema({
  name: String,
  passport: { number: String, expiryDate: Date } // Embedded/Nested
});
\end{lstlisting}
\textbf{1-Many (Refs):}Use\texttt{mongoose.Types.ObjectId}+ \texttt{ref:"ColName".Use.popu()}.
\begin{lstlisting}
const postSchema = new mongoose.Schema({
  author: { 
    type: mongoose.Schema.Types.ObjectId, // Stores ID
    ref: 'User' // Links to User model
  }
});
const posts = await Post.find().populate('author'); // Joins data
\end{lstlisting}
\textbf{Many-Many (Junction):} Third model holding both IDs.
\begin{lstlisting}
const enrollSchema = new mongoose.Schema({
  student: { type: mongoose.Schema.Types.ObjectId, ref: 'Student' }, // ID Ref
  course: { type: mongoose.Schema.Types.ObjectId, ref: 'Course' }  // ID Ref
});
// Populates both linked documents:
const e = await Enrollment.find().populate('student').populate('course');
\end{lstlisting}

\compactsection{Advanced Node.js/Mongo}
\textbf{Insert:} \texttt{insertOne(obj, cb)} $\mid$ \textbf{Sort:} \texttt{find().sort(\{n:1\})} $\mid$ \textbf{Limit:} \texttt{find().limit(5)} $\mid$ \textbf{\$lookup:} Join pipeline.

\topicsection{NODE.JS FUNDAMENTALS}

\compactsection{Node.js Fundamentals}
Async, single-threaded runtime. \\
\textbf{Libuv:} C++ library for I/O thread pool. \\
\textbf{NPM:} \texttt{npm init} $\mid$ \texttt{npm install -g} (Global) $\mid$ \textbf{dep:} Prod $\mid$ \textbf{devDep:} Testing $\mid$ \textbf{lockfile:} Reproduction $\mid$ \textbf{npm ci:} Fast clean install.

\compactsection{Global \& Utility Modules}
\textbf{OS:} \texttt{platform(), totalmem()} $\mid$ \textbf{Path:} \texttt{resolve(), extname()}\\
\textbf{DNS:} \texttt{lookup(domain, cb)} $\mid$ \textbf{Console:} \texttt{time(), timeEnd()}\\
\textbf{Globals:} \texttt{\_\_dirname} (folder), \texttt{\_\_filename} (file)
\begin{lstlisting}
const os = require('os'), path = require('path'), dns = require('dns');
console.time('r');
dns.lookup('google.com', (e, ip) => { console.log(ip); });
console.timeEnd('r');
\end{lstlisting}

\compactsection{Debugging \& Callbacks}
\textbf{Console:} \texttt{trace()} (stack). \textbf{Callbacks:} Error-First pattern.
\begin{lstlisting}
console.time('c'); let s=0; for(let i=0;i<1e6;i++) s+=i; console.timeEnd('c');
function a() { b(); } function b() { console.trace(); } a();

function fetch(cb) {
  setTimeout(() => { const e = Math.random()>0.5?null:new Error('F'); cb(e, e?null:'D'); }, 10);
}
fetch((e, d) => { if(e) console.error(e.message); else console.log(d); });
\end{lstlisting}

\end{multicols*}

\end{document}
