\section{Chapter 7: MongoDB and Mongoose - Database Management}

MongoDB is a NoSQL, document-oriented database that stores data in flexible, JSON-like documents. This means fields can vary from document to document and data structure can be changed over time.

\begin{tcolorbox}[colback=red!5,colframe=red!75,title=Exam Tips \& Hints]
\begin{itemize}
    \item \textbf{RDBMS vs NoSQL}: Be prepared to compare Tables/Collections and Rows/Documents.
    \item \textbf{Mongoose Schema}: Know how to define types and required fields in a Mongoose schema.
    \item \textbf{Relationships}: Understand the pros and cons of Embedding vs Referencing.
    \item \textbf{\_id}: Every document has a unique \texttt{\_id} field by default.
\end{itemize}
\end{tcolorbox}

\subsection{Core Concepts}
\begin{longtable}{ll}
\toprule
RDBMS Terminology & MongoDB Terminology \\
\midrule
Database & Database \\
Table & Collection \\
Row / Tuple & Document \\
Column & Field \\
Table Join & Embedded Documents / \$lookup \\
Primary Key & Primary Key (Default \texttt{\_id}) \\
\bottomrule
\end{longtable}

\subsubsection{Advantages of MongoDB}
\begin{itemize}
    \item \textbf{Schema-less}: Documents in a collection don't need the same fields.
    \item \textbf{Easy Scalability}: Designed to scale out across servers.
    \item \textbf{High Performance}: Uses internal memory for faster data access.
\end{itemize}

\subsection{MongoDB Shell Commands}
\begin{itemize}
    \item \textbf{\texttt{use mydb}}: Switch to or create a database.
    \item \textbf{\texttt{db.createCollection('users')}}: Create a new collection.
    \item \textbf{\texttt{db.users.insert(\{name: 'John'\})}}: Insert a document.
    \item \textbf{\texttt{db.users.find()}}: Query all documents.
    \item \textbf{\texttt{db.users.update(\{name: 'John'\}, \{\$set: \{age: 30\}\})}}: Update a document.
    \item \textbf{\texttt{db.users.remove(\{name: 'John'\})}}: Remove a document.
    \item \textbf{\texttt{db.dropDatabase()}}: Delete the current database.
\end{itemize}

\subsection{Using MongoDB with Node.js}
\subsubsection{Native MongoDB Driver}
Requires the \texttt{mongodb} npm package.
\begin{lstlisting}[language=JavaScript]
const { MongoClient } = require('mongodb');
const url = "mongodb://localhost:27017/";

MongoClient.connect(url, (err, db) => {
  if (err) throw err;
  const dbo = db.db("mydb");
  dbo.collection("customers").findOne({}, (err, result) => {
    console.log(result.name);
    db.close();
  });
});
\end{lstlisting}

\subsection{Mongoose - Elegant Object Modeling}
Mongoose provides a schema-based solution to model your application data.
    \item \textbf{Schema}: Defines the structure of the document.
    \item \textbf{Model}: A constructor that creates documents based on the schema.
\end{itemize}

\subsubsection{Defining a Schema and Model}
\begin{lstlisting}[language=JavaScript]
const mongoose = require('mongoose');

const userSchema = new mongoose.Schema({
  name: String,
  email: { type: String, required: true },
  createdAt: { type: Date, default: Date.now }
});

const User = mongoose.model('User', userSchema);
\end{lstlisting}

\begin{tcolorbox}[colback=green!5,colframe=green!75,title=Practical Example: Schema and Validation]
Defining a strict schema for a "Product" collection:
\begin{lstlisting}[language=JavaScript]
const productSchema = new mongoose.Schema({
  name: { type: String, required: [true, 'Name is required'] },
  price: { type: Number, min: 0 },
  category: { type: String, enum: ['Electronics', 'Books', 'Clothing'] },
  inStock: { type: Boolean, default: true }
});

const Product = mongoose.model('Product', productSchema);
\end{lstlisting}
\end{tcolorbox}

    \item \textbf{Many-to-Many}: Create a third "junction" collection to track relationships between two other collections.
\end{enumerate}

\begin{tcolorbox}[colback=yellow!5,colframe=yellow!75,title=Practical Example: Mongoose Relationships]
Using \texttt{ref} and \texttt{populate()} to link data:
\begin{lstlisting}[language=JavaScript]
// Post Schema
const postSchema = new mongoose.Schema({
  title: String,
  author: { type: mongoose.Schema.Types.ObjectId, ref: 'User' }
});

// Query with Populate
Post.find()
  .populate('author') // Replaces ID with actual User object
  .then(posts => console.log(posts));
\end{lstlisting}
\end{tcolorbox}

\input{qa_fragments/ch7_qa}



